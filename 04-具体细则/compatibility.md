## [Must] 保持向后兼容性
我们可以更改 API，但要确保所有使用者正常运行。API 消费者通常拥有独立的发布周期，注定稳定性，避免不提供额外价值的更改。API 是服务提供者和服务消费者之间的合同，不能通过单方面的决定来破坏。

有两种技术可以在不破坏 API 的情况下改变 API：
- 遵循兼容扩展的规则
- 引入新的 API 版本，并支持旧版本

我们强烈建议使用兼容的API扩展，不鼓励版本化。
以下针对服务提供者和消费者的指导原则使我们（拥有Postel法则）能够在不进行版本控制的情况下进行兼容性更改。

## [Should] 优先兼容扩展
API 设计人员应该应用以下规则以向后兼容的方式为服务演进 RESTful API：

- 只添加可选的，从不强制要有的字段。
- 不要更改字段的语义（例如，不能将语义从客户号码更改为客户ID，虽然两者都是唯一客户密钥）
- 输入字段可能会通过服务器端业务逻辑来验证（复杂）约束。切勿将验证逻辑更改为更具限制性，并确保在描述中明确定义所有约束。
- 仅当服务器准备好接受并处理旧范围值时，才可以减少作为输入参数的枚举范围。用作输出参数时，可以减少枚举范围。
- 用于输出参数时，不能扩展枚举范围 - 客户端可能没有准备好处理它。但是，用于输入参数时，枚举范围可以扩展。
- 如果枚举是输出参数，并且可能随着功能的增长而扩展，请使用 x-extensible-enum。它定义了一个显式值的开放列表，新值对客户端是未知的。
- 支持重定向，以防万一URL改变（301永久移动）

## [Must] 确保客户端在 API 做兼容扩展时不奔溃
客户端应该运用健壮性原则：
- 对 API 请求和输入数据要持保守态度
- 处理和读取 API 响应数据时要宽容，更具体地说就是服务客户端必须为服务提供者兼容的API扩展做好准备：
    - 针对 API 响应数据中发现的未知字段要容忍，即：如果有后续的PUT请求，请忽略新的字段，而不是删除新的字段。
    - 针对 x-extensible-enum 返回参数可能提供新值; 要么是不可知的，要么为未知值提供默认行为。
    - 准备处理未在端点定义中明确指定的HTTP状态码。 还要注意，这个状态码是可扩展的。 默认的处理是如何处理相应的x00代码。
    - 当服务器返回HTTP状态301永久移动时，请遵循重定向。


## [Should] 设计保守 API

## [Should] 始终将JSON对象作为顶级数据结构返回以支持可扩展性
在响应正文中，您必须始终返回一个JSON对象（而不是数组）作为顶级数据结构，以支持将来的扩展性。JSON对象通过附加属性支持兼容的扩展。这使您可以轻松地扩展您的响应，例如稍后添加分页，而不会破坏向后兼容性。

## [Should] 避免版本化
更改 RESTful API 时，请以兼容的方式进行操作，并避免生成其他 API 版本。 多个版本可能使我们的系统的理解，测试，维护，演变，操作和发布（补充阅读）变的明显复杂化。

如果更改 API 不能以兼容的方式完成，则可以采取以下三种方法之一：
- 除旧资源变体外，另外创建新资源（变体）
- 创建一个新的服务端点 - 即带有新 API 的新应用程序（使用新的域名）
- 通过相同的微服务创建与旧API并行支持的新API版本

由于存在各种各样的缺点，我们竭力反对版本化，所以我们强烈建议只使用前两种方法。

## [Should] 使用 Media Type 版本控制
如果 API 版本不可避免，则必须使用媒体类型版本控制（而不是 URI 版本控制）来设计多版本 RESTful API。 媒体类型版本控制耦合度低，因为它支持内容协商，因此降低了版本管理的复杂性。

示例：
```
  Accept: application/api.xxx.kyeegroup+json;version=2
```

使用媒体类型版本控制时要注意以下两点：
1. 把版本信息包含在请求和响应头中来提高可见性
2. 在 Vary 头部中包含 Content-Type，以允许代理同时缓存多个不同版本

## [Must] 不要使用 URI 版本控制








